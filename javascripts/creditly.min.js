var Creditly=function(){var e=function(e,t){var a=document.querySelector(t).value.trim();return a+=String.fromCharCode(e.which),r(a)},r=function(e){return e.replace(/[^\d]/g,"")},t=function(e){e.className=e.className.replace(/\bhas-error\b/,"")},a=function(r,t,a){return e(r,a).length>t},n=function(e){return e.metaKey||e.ctrlKey?!0:32===e.which?!1:0===e.which?!0:e.which<33?!0:!1},u=function(e){return/^\d+$/.test(String.fromCharCode(e.which))},i=function(e){return e.preventDefault(),u(e)?!0:!1},c=function(e){return e.match("^(34|37)")},s=function(e,r,t){var u=e.currentTarget;return a(e,r,t)?(e.preventDefault(),!1):u.selectionStart!==u.value.length?!1:!n(e)&&i(e,r,t)},v=function(){var r=function(r,a){var n=function(e){return e?4:3};document.querySelector(r).addEventListener("keypress",function(u){var i=document.querySelector(r);t(i);var v=e(u,a),o=e(u,r),l=c(v),f=n(l);s(u,f,r)&&(i.value=o)})};return{createCvvInput:r}}(),o=function(){var r=[4,10,15],a=[4,8,12,16],n=function(e){return e?15:16},u=function(u){document.querySelector(u).addEventListener("keypress",function(v){var o=document.querySelector(u);t(o);var l=e(v,u),f=c(l),d=n(f);if(s(v,d,u)){var m;m=f?i(l,r):i(l,a),o.value=m;var p=document.createEvent("HTMLEvents");p.initEvent("changed_input",!0,!0),o.dispatchEvent(p)}})},i=function(e,r){for(var t=[],a=0,n=0;n<r.length;n++){if(!(e.length>r[n])){t.push(n<r.length?e.slice(a,r[n]):e.slice(a));break}t.push(e.slice(a,r[n])),a=r[n]}return t.length>0?t.join(" "):e};return{createNumberInput:u}}(),l=function(){var e=function(){var e=/(\d\d)\s*\/\s*(\d\d)/,r=function(r,t){var a=document.querySelector(r).value.trim(),n=e.exec(a),u=!1,i=["",""];if(n&&3===n.length){var c=parseInt(n[1],10),s=parseInt("20"+n[2],10);if(c>=0&&12>=c){u=!0;var i=[c,s]}}return{is_valid:u,messages:[t.message],output_value:i}},t=function(e,r){return e&&4==r.length||!e&&3==r.length?!0:!1},a=function(e,r){var a=document.querySelector(r.creditCardNumberSelector).value,i=a.trim().replace(/\D/g,""),c=[],s=!0,v=[];if(u(i)||(c.push(r.message.number),v.push(r.creditCardNumberSelector),s=!1),r.cvvSelector){var o=document.querySelector(r.cvvSelector).value,l=o.trim().replace(/\D/g,"");t(n(i),l)||(c.push(r.message.security_code),v.push(r.cvvSelector),s=!1)}return result={is_valid:s,output_value:[i,l],selectors:v,messages:c}},n=function(e){return 15==e.length},u=function(e){if(0===e.length)return!1;if(/[^0-9-\s]+/.test(e))return!1;for(var r=0,t=0,a=!1,n=e.length-1;n>=0;n--){var u=e.charAt(n),t=parseInt(u,10);a&&(t*=2)>9&&(t-=9),r+=t,a=!a}return r%10==0};return{creditCard:a,creditCardExpiration:r}}(),r=function(){var e=[],r=[],t=function(t,a){a.hasOwnProperty("selectors")?r=r.concat(a.selectors):r.push(t),e=e.concat(a.messages)},a=function(){for(var t={selectors:r,messages:e},a=0;a<r.length;a++)document.querySelector(r[a]).className=document.querySelector(r[a]).className+" has-error";if(window.jQuery)window.jQuery("body").trigger("creditly_client_validation_error",t);else{var n=document.createEvent("MessageEvent");n.initMessageEvent("creditly_client_validation_error",!0,!0,t,"","","",null),document.body.dispatchEvent(n)}};return{addError:t,triggerErrorMessage:a}},t=function(){var e={},r=function(r,t){for(var a=r.split("."),n=e,u=0;u<a.length;u++)n.hasOwnProperty(a[u])||(n[a[u]]={}),u===a.length-1?n[a[u]]=t:n=n[a[u]]},t=function(){return e};return{addOutput:r,getOutput:t}},a=function(r,t,a,n){if(t.hasOwnProperty(r)){var u=t[r],i=u.type,s=(u.name,e[i](r,u.data));if(!s.is_valid)return a.addError(r,s),!0;if(u.output_name instanceof Array)for(var v=0;v<u.output_name.length;v++)n.addOutput(u.output_name[v],s.output_value[v]);else n.addOutput(u.output_name,s.output_value)}},n=function(e){var n=r(),u=t(),i=!1;for(var c in e)a(c,e,n,u)&&(i=!0);return i?(n.triggerErrorMessage(),!1):u.getOutput()};return{validate:n}}(),f=function(){var r=4,a=function(a){document.querySelector(a).addEventListener("keypress",function(n){var u=document.querySelector(a);if(t(u),s(n,r,a)){var i=e(n,a);if(i.length>=2){var c=i.slice(0,2)+" / "+i.slice(2);u.value=c}else u.value=i}})};return{createExpirationInput:a}}(),d=function(){var e=function(e){return/^(34|37)/.test(e)?"American Express":/^4/.test(e)?"Visa":/^5[0-5]/.test(e)?"MasterCard":/^(6011|622|64[4-9]|65)/.test(e)?"Discover":""},t=function(t,a){var n=document.querySelector(t),u=function(){var u=document.querySelector(t).value,i=e(r(u));document.querySelector(a).innerHTML=i};n.addEventListener("changed_input",u),n.addEventListener("keypress",u),n.addEventListener("keydown",u),n.addEventListener("keyup",u)};return{changeCardType:t}}(),m=function(e,r,t,a,n){var u=p(e,r,t,n);return f.createExpirationInput(e),o.createNumberInput(r),t&&v.createCvvInput(t,r),a&&d.changeCardType(r,a),{validate:function(){return l.validate(u)}}},p=function(e,r,t,a){var n=a||{};n.security_code_message=n.security_code_message||"Your security code is invalid",n.number_message=n.number_message||"Your credit card number is invalid",n.expiration_message=n.expiration_message||"Your credit card expiration is invalid";var u={};return u[r]={type:"creditCard",data:{cvvSelector:t,creditCardNumberSelector:r,message:{security_code:n.security_code_message,number:n.number_message}},output_name:["number","security_code"]},u[e]={type:"creditCardExpiration",data:{message:n.expiration_message},output_name:["expiration_month","expiration_year"]},u};return{initialize:m}}();